<Page
    x:Class="Files.Views.PropertiesSecurityAdvanced"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:Microsoft.Toolkit.Uwp.UI.Behaviors"
    xmlns:converters="using:Microsoft.Toolkit.Uwp.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:icore="using:Microsoft.Xaml.Interactions.Core"
    xmlns:local="using:Files.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:perm="using:Files.Filesystem.Permissions"
    d:DesignHeight="550"
    d:DesignWidth="700"
    Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
    KeyDown="Page_KeyDown"
    Loaded="Properties_Loaded"
    Loading="Page_Loading"
    Unloaded="Properties_Unloaded"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="ms-appx:///ResourceDictionaries/PropertiesStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:BoolNegationConverter x:Key="BoolNegationConverter" />
            <converters:BoolToObjectConverter
                x:Key="BoolToMinWidthConverter"
                FalseValue="0"
                TrueValue="200" />
            <converters:BoolToObjectConverter
                x:Key="BoolToWidthConverter"
                FalseValue="0"
                TrueValue="*" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <TextBlock
            Margin="14,0,0,0"
            VerticalAlignment="Center"
            Text="{x:Bind DialogTitle}" />

        <Grid Grid.Row="1">
            <StackPanel Margin="0,7,0,0" Style="{StaticResource PropertiesTab}">
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        x:Uid="SecurityOwnerLabel"
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Style="{StaticResource PropertyName}"
                        Text="Owner" />

                    <FontIcon
                        x:Name="FontIcon"
                        Grid.Column="1"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        FontFamily="{StaticResource SymbolThemeFontFamily}"
                        Glyph="{x:Bind ViewModel.FilePermissions.Owner.Glyph, Mode=OneWay}" />

                    <TextBlock
                        x:Name="OwnerText"
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        x:Load="{x:Bind ViewModel.FilePermissions.CanReadFilePermissions, Mode=OneWay}">
                        <Run Text="{x:Bind ViewModel.FilePermissions.Owner.DisplayName, Mode=OneWay}" />
                        <Span FontWeight="Light">&#160;(</Span>
                        <Run FontWeight="Light" Text="{x:Bind ViewModel.FilePermissions.Owner.FullNameOrSid, Mode=OneWay}" />
                        <Span FontWeight="Light">)</Span>
                    </TextBlock>

                    <TextBlock
                        x:Name="UnknownOwnerText"
                        x:Uid="SecurityUnknownOwnerText"
                        Grid.Column="2"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        x:Load="{x:Bind ViewModel.FilePermissions.CanReadFilePermissions, Converter={StaticResource BoolNegationConverter}, Mode=OneWay}"
                        Text="Unknown owner" />

                    <Button
                        Grid.Column="3"
                        Padding="8,4,8,4"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderBrush="Transparent"
                        Command="{x:Bind ViewModel.EditOwnerCommand}">
                        <FontIcon FontSize="16" Glyph="&#xE104;" />
                    </Button>
                </Grid>

                <Grid Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock
                        x:Uid="SecurityAdvancedPermissionsLabel"
                        VerticalAlignment="Center"
                        FontWeight="Bold"
                        Style="{StaticResource PropertyName}"
                        Text="Permissions" />

                    <StackPanel
                        Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="4">
                        <Button
                            Padding="8,4,8,4"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Command="{x:Bind ViewModel.AddAccessRuleCommand}">
                            <FontIcon FontSize="16" Glyph="&#xE109;" />
                        </Button>
                        <Button
                            Padding="8,4,8,4"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Command="{x:Bind ViewModel.RemoveAccessRuleCommand}">
                            <FontIcon FontSize="16" Glyph="&#xE108;" />
                        </Button>
                    </StackPanel>
                </Grid>

                <ListView
                    x:Name="ListView"
                    Height="204"
                    x:Load="{x:Bind ViewModel.FilePermissions.CanReadFilePermissions, Mode=OneWay}"
                    Background="{ThemeResource SolidBackgroundAcrylic}"
                    BorderBrush="Gray"
                    BorderThickness="1"
                    CornerRadius="4"
                    ItemsSource="{x:Bind ViewModel.FilePermissions.AccessRules, Mode=OneWay}"
                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                    ScrollViewer.HorizontalScrollMode="Auto"
                    SelectionChanged="ListView_SelectionChanged"
                    SelectionMode="Extended">
                    <i:Interaction.Behaviors>
                        <behaviors:StickyHeaderBehavior />
                    </i:Interaction.Behaviors>
                    <ListView.ItemContainerStyle>
                        <Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
                            <Setter Property="MinHeight" Value="40" />
                            <Setter Property="Height" Value="40" />
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.Header>
                        <Grid
                            Margin="12,0,12,0"
                            Padding="0,8,0,8"
                            Background="{ThemeResource SolidBackgroundAcrylic}"
                            BorderBrush="{ThemeResource SystemChromeHighColor}"
                            BorderThickness="0,0,0,1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="32" />
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="*" MinWidth="200" />
                                <ColumnDefinition Width="*" MinWidth="160" />
                                <ColumnDefinition Width="70" />
                                <ColumnDefinition Width="{x:Bind ViewModel.IsFolder, Converter={StaticResource BoolToWidthConverter}, Mode=OneWay}" MinWidth="{x:Bind ViewModel.IsFolder, Converter={StaticResource BoolToMinWidthConverter}, Mode=OneWay}" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                x:Uid="SecurityAdvancedTypeLabel"
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                FontWeight="SemiBold"
                                Text="Type" />
                            <TextBlock
                                x:Uid="SecurityAdvancedEntityLabel"
                                Grid.Column="2"
                                FontWeight="SemiBold"
                                Text="Entity" />
                            <TextBlock
                                x:Uid="SecurityAdvancedAccessLabel"
                                Grid.Column="3"
                                FontWeight="SemiBold"
                                Text="Access" />
                            <TextBlock
                                x:Uid="SecurityAdvancedInheritedLabel"
                                Grid.Column="4"
                                FontWeight="SemiBold"
                                Text="Inherited" />
                            <TextBlock
                                x:Name="AppliesToLabel"
                                x:Uid="SecurityAdvancedAppliesToLabel"
                                Grid.Column="5"
                                FontWeight="SemiBold"
                                Text="Applies to"
                                Visibility="{x:Bind ViewModel.IsFolder, Mode=OneWay}" />
                        </Grid>
                    </ListView.Header>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="perm:FileSystemAccessRuleForUI">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="32" />
                                    <ColumnDefinition Width="50" />
                                    <ColumnDefinition Width="*" MinWidth="200" />
                                    <ColumnDefinition Width="*" MinWidth="160" />
                                    <ColumnDefinition Width="70" />
                                    <ColumnDefinition Width="{x:Bind IsFolder, Converter={StaticResource BoolToWidthConverter}, Mode=OneWay}" MinWidth="{x:Bind IsFolder, Converter={StaticResource BoolToMinWidthConverter}, Mode=OneWay}" />
                                </Grid.ColumnDefinitions>

                                <FontIcon
                                    x:Name="FontIcon"
                                    HorizontalAlignment="Left"
                                    FontFamily="{StaticResource SymbolThemeFontFamily}"
                                    Glyph="{x:Bind UserGroup.Glyph}" />

                                <FontIcon
                                    Grid.Column="1"
                                    HorizontalAlignment="Center"
                                    FontFamily="{StaticResource SymbolThemeFontFamily}"
                                    Glyph="{x:Bind Glyph}" />

                                <TextBlock Grid.Column="2" TextTrimming="CharacterEllipsis">
                                    <Run Text="{x:Bind UserGroup.DisplayName}" />
                                    <Span FontWeight="Light">&#160;(</Span>
                                    <Run FontWeight="Light" Text="{x:Bind UserGroup.FullNameOrSid}" />
                                    <Span FontWeight="Light">)</Span>
                                </TextBlock>

                                <TextBlock
                                    Grid.Column="3"
                                    Text="{x:Bind FileSystemRightsForUI, Mode=OneWay}"
                                    TextTrimming="CharacterEllipsis" />

                                <TextBlock Grid.Column="4" Text="{x:Bind IsInheritedForUI}" />

                                <TextBlock
                                    Grid.Column="5"
                                    Text="{x:Bind InheritanceFlagsForUI, Mode=OneWay}"
                                    TextTrimming="CharacterEllipsis"
                                    Visibility="{x:Bind IsFolder, Mode=OneWay}" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="2" Padding="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Button
                x:Name="OKButton"
                x:Uid="PropertiesDialogOKButton"
                Grid.Column="1"
                MinWidth="100"
                Margin="0,0,10,0"
                HorizontalAlignment="Right"
                Click="OKButton_Click"
                Content="OK"
                Style="{StaticResource AccentButtonStyle}" />
            <Button
                x:Name="CancelButton"
                x:Uid="PropertiesDialogCancelButton"
                Grid.Column="2"
                MinWidth="100"
                HorizontalAlignment="Right"
                Click="CancelButton_Click"
                Content="Cancel" />
        </Grid>
    </Grid>
</Page>
